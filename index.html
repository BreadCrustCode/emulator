<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emulator448</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background: #020617;
  overflow: hidden;
}
#game { width: 100vw; height: 100vh; background: #000; }
#loadBtn {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 1rem 2rem;
  font-size: 1.5rem;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  background: #22d3ee;
  color: #001018;
  cursor: pointer;
  z-index: 10;
}
</style>
</head>
<body>

<button id="loadBtn">Load ROM</button>
<input type="file" id="romInput" accept=".nes,.smc,.sfc,.gba,.gbc,.gb,.n64,.z64,.v64,.nds,.3ds,.cia,.iso,.bin,.cue,.gen,.smd,.zip,.img,.exe,.cso,.pkg" style="display:none;">
<div id="game"></div>

<script>
const loadBtn = document.getElementById('loadBtn');
const romInput = document.getElementById('romInput');
const gameDiv = document.getElementById('game');

const coreMap = {
  '.nes': 'nes', '.smc': 'snes', '.sfc': 'snes', '.gba': 'gba',
  '.gbc': 'gbc', '.gb': 'gb', '.n64': 'n64', '.z64': 'n64', '.v64': 'n64',
  '.nds': 'nds', '.3ds': '3ds', '.cia': '3ds', '.iso': 'ps1',
  '.bin': 'ps1', '.cue': 'ps1', '.gen': 'genesis', '.smd': 'genesis',
  '.zip': 'mame', '.img': 'dos', '.exe': 'dos', '.cso': 'psp', '.pkg': 'ps3'
};

function getCore(filename){
  const ext = filename.slice(filename.lastIndexOf('.')).toLowerCase();
  return coreMap[ext] || null;
}

// Show file picker when button clicked
loadBtn.addEventListener('click', () => romInput.click());

romInput.addEventListener('change', () => {
  const rom = romInput.files[0];
  if (!rom) return;

  const core = getCore(rom.name);
  if (!core) return alert("Unsupported ROM: " + rom.name);

  const romURL = URL.createObjectURL(rom);

  // Hide button once ROM is loading
  loadBtn.style.display = 'none';

  window.EJS_player = "#game";
  window.EJS_core = core;
  window.EJS_gameUrl = romURL;
  window.EJS_pathtodata = "https://cdn.emulatorjs.org/stable/data/";

  const existing = document.getElementById('emulatorJS');
  if (existing) existing.remove();

  const script = document.createElement('script');
  script.id = 'emulatorJS';
  script.src = "https://cdn.emulatorjs.org/stable/data/loader.js";
  script.onload = () => {
    // Auto fullscreen
    if (gameDiv.requestFullscreen) gameDiv.requestFullscreen();
    else if (gameDiv.webkitRequestFullscreen) gameDiv.webkitRequestFullscreen();
  };
  document.body.appendChild(script);
});
</script>

</body>
</html>
